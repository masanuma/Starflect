# Level1（お手軽12星座占い）3要素統合仕様

## 概要
Level1は初心者向けの12星座占いで、3つの要素を統合した個人化された占い結果を提供します。

## 入力要素（INPUT）

### 1. 生まれた時の天体情報（制限あり）
```typescript
{
  太陽星座: sunSign,  // 例: "牡牛座"（生年月日のみから算出）
  // 注意: 出生地・出生時刻・上昇星座は取得不可
}
```

### 2. 現在の天体情報
```typescript
{
  対象日時: selectedPeriod対応の日時,  // 今日、明日、今週など
  現在の主要天体: [
    { planet: "太陽", sign: "獅子座", degree: 15.2 },
    { planet: "月", sign: "双子座", degree: 28.7 },
    { planet: "水星", sign: "獅子座", degree: 3.1 },
    { planet: "金星", sign: "乙女座", degree: 8.9 },
    { planet: "火星", sign: "天秤座", degree: 12.4 },
    { planet: "木星", sign: "蟹座", degree: 22.1 },
    { planet: "土星", sign: "牡羊座", degree: 5.7 },
    // ... 他の天体
  ]
}
```

### 3. ユーザーの性格傾向（太陽星座定型）
```typescript
{
  基本特徴: getSunSignFortuneContext(sunSign),  // 太陽星座の詳細特徴
  // 例: "牡牛座の基本的な特徴\n性格: 安定志向で実用的..."
}
```

## 出力仕様（OUTPUT）

### 文字数
- **各項目**: 60-100文字（2-3文程度）
- **合計**: 約300-500文字
- **項目数**: 5項目

### 出力項目
```
【全体運】 60-100文字
【恋愛運】 60-100文字  
【仕事運】 60-100文字
【健康運】 60-100文字
【金銭運】 60-100文字
```

### 必須要件
各項目で以下を必ず含む：
1. **太陽星座の特徴への言及**
2. **現在の天体配置の影響**
3. **期間特有の要素**（今日・明日・今週等）

## プロンプト設計

### 3要素統合指示
```
【1. あなたの星座情報】
太陽星座: ${sunSign}

【2. 現在の天体配置】
${todayTransits.map(p => `${p.planet}: ${p.sign}座`).join(', ')}

【3. ${sunSign}座の基本的な特徴】
${sunSignTraits}
```

### 厳守事項
```
**厳守事項**: 
- 必ず各項目60-100文字で記述
- 必ず${sunSign}座の特徴に言及
- 必ず現在の天体配置の影響を明記
- 必ず期間の特徴を反映
```

## 期間対応

### 対応期間
- 今日の占い
- 明日の占い
- 今週の占い
- 来週の占い
- 1ヶ月の占い

### 期間別要素
- **今日**: 今日の天体の動き、今日のタイミング
- **明日**: 明日の天体変化、明日への準備
- **今週**: 週間の流れ、週の重要ポイント
- **来週**: 次週の展望、準備すべきこと
- **1ヶ月**: 月間の大きな流れ、月の重要イベント

## エラーハンドリング

### トランジット計算エラー時
フォールバック処理で以下を実行：
1. 太陽星座の定型特徴を使用
2. 期間要素は保持
3. 同様の文字数・要素要件を適用

### 実装例
```typescript
try {
  // 3要素統合版プロンプト
  const todayTransits = await calculateTransitPositions(...);
  const sunSignTraits = getSunSignFortuneContext(sunSign);
  // メインプロンプト実行
} catch (transitError) {
  // フォールバック版プロンプト
  const sunSignTraitsFallback = getSunSignFortuneContext(sunSign);
  // 簡略プロンプト実行（太陽星座特徴は含む）
}
```

## 品質保証

### テスト項目
1. **文字数**: 各項目が60-100文字になるか
2. **3要素統合**: プロンプトに3つの情報が含まれるか
3. **期間要素**: 選択した期間の特徴が反映されるか
4. **エラーハンドリング**: フォールバック処理が正常動作するか
5. **パフォーマンス**: 応答時間が適切か

### 成功基準
- 各項目の文字数: 60-100文字
- 太陽星座の特徴言及: 100%
- 現在天体配置の言及: 100%（トランジット成功時）
- 期間要素の反映: 100%

---

**重要**: この仕様は機能分類マトリクス（Level1占い機能）に基づいて設計されています。
分析機能との混同を避け、純粋な期間限定の運勢予測に特化しています。 